version: 2.1

jobs:
  build:
    docker:
      - image: circleci/golang:1.16
    working_directory: /go/src/github.com/caesium-cloud/caesium
    steps:
      - checkout
      - run: go get -v -t -d ./...
      - run: go test -v -race -cover ./...
      - setup_remote_docker:
          version: 19.03.13
      - run: |
          docker build -t caesium-cloud/caesium:${CIRCLE_SHA1:0:7} .